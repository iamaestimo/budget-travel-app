<section class="bg-blue-600 text-white py-8">
  <div class="container mx-auto px-4">
    <h1 class="text-3xl font-bold text-center mb-2">
      <i class="fas fa-hotel mr-2"></i> Hotel Search Results
    </h1>
    <h2 class="text-lg text-center text-blue-100">
      <%= params[:city_code] || "BKK" %> | 
      <%= Date.parse(params[:check_in_date] || (Date.today + 7.days).strftime("%Y-%m-%d")).strftime("%b %d") %> - 
      <%= Date.parse(params[:check_out_date] || (Date.today + 10.days).strftime("%Y-%m-%d")).strftime("%b %d, %Y") %> | 
      <%= params[:rooms] || 1 %> Room<%= (params[:rooms].to_i || 1) > 1 ? 's' : '' %>, 
      <%= params[:adults] || 2 %> Adult<%= (params[:adults].to_i || 2) > 1 ? 's' : '' %>
    </h2>
  </div>
</section>

<section class="py-8">
  <div class="container mx-auto px-4">
    <!-- Search Summary -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
      <div class="flex flex-wrap justify-between items-center">
        <div class="flex items-center space-x-4">
          <div class="text-sm">
            <span class="text-gray-500">Currency:</span> 
            <span class="font-medium"><%= params[:currency] || "USD" %></span>
          </div>
          
          <% if params[:max_price].present? %>
            <div class="text-sm">
              <span class="text-gray-500">Max Price:</span> 
              <span class="font-medium"><%= params[:max_price] %> <%= params[:currency] || "USD" %></span>
            </div>
          <% end %>
          
          <% if params[:ratings].present? && params[:ratings].is_a?(Array) %>
            <div class="text-sm">
              <span class="text-gray-500">Rating:</span> 
              <span class="font-medium">
                <%= params[:ratings].join(", ") %> 
                <i class="fas fa-star text-yellow-400"></i>
              </span>
            </div>
          <% end %>
        </div>
        
        <div>
          <%= link_to hotel_search_path(params.permit!), class: "text-blue-600 hover:text-blue-800 text-sm" do %>
            <i class="fas fa-edit mr-1"></i> Modify Search
          <% end %>
        </div>
      </div>
    </div>
    
    <!-- Results Header -->
    <h2 class="text-2xl font-bold mb-6">
      <% if @hotels.any? %>
        <span class="inline-flex items-center">
          <i class="fas fa-check-circle text-green-500 mr-2"></i>
          <span><%= @hotels.count %> Hotels Found</span>
        </span>
      <% else %>
        <span class="inline-flex items-center">
          <i class="fas fa-search mr-2"></i>
          <span>Search Results</span>
        </span>
      <% end %>
    </h2>
    
    <% if @hotels.any? %>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <% @hotels.each do |hotel| %>
          <div class="hotel-card">
            <div class="bg-white rounded-lg shadow-md overflow-hidden mb-4">
              <!-- Card Header with Hotel Name and Rating -->
              <div class="bg-blue-600 text-white p-4 flex justify-between items-center">
                <h3 class="font-bold text-lg truncate">
                  <i class="fas fa-hotel mr-2"></i>
                  <%= hotel[:name] %>
                </h3>
                
                <div>
                  <% if hotel[:rating].present? %>
                    <% hotel[:rating].to_i.times do %>
                      <i class="fas fa-star text-yellow-300"></i>
                    <% end %>
                  <% end %>
                </div>
              </div>
              
              <!-- Hotel Image and Basic Info -->
              <div class="md:flex">
                <!-- Hotel Image -->
                <div class="md:w-1/3 h-48 bg-gray-200 relative">
                  <% if hotel[:media].present? && hotel[:media].first.present? %>
                    <img 
                      src="<%= hotel[:media].first[:url] %>" 
                      alt="<%= hotel[:name] %>" 
                      class="w-full h-full object-cover"
                      onerror="this.onerror=null; this.src='https://placehold.co/600x400?text=Hotel+Image';"
                    >
                  <% else %>
                    <div class="w-full h-full flex items-center justify-center bg-gray-100">
                      <i class="fas fa-hotel text-gray-400 text-5xl"></i>
                    </div>
                  <% end %>
                </div>
                
                <!-- Hotel Info -->
                <div class="md:w-2/3 p-4">
                  <!-- Address -->
                  <div class="mb-3">
                    <p class="text-gray-600 text-sm flex items-start">
                      <i class="fas fa-map-marker-alt text-red-500 mr-2 mt-1"></i>
                      <%= hotel[:address] %>
                    </p>
                  </div>
                  
                  <!-- Brief Description -->
                  <div class="mb-3">
                    <p class="text-gray-800 text-sm line-clamp-2">
                      <%= hotel[:description].present? ? hotel[:description][0..150] + (hotel[:description].length > 150 ? "..." : "") : "No description available." %>
                    </p>
                  </div>
                  
                  <!-- Amenities -->
                  <div class="mb-3">
                    <p class="text-gray-600 text-sm">
                      <% if hotel[:amenities].present? %>
                        <% 
                          amenity_icons = {
                            "SWIMMING_POOL" => "swimming-pool",
                            "SPA" => "spa",
                            "RESTAURANT" => "utensils",
                            "PARKING" => "parking",
                            "PETS_ALLOWED" => "paw",
                            "WIFI" => "wifi",
                            "ROOM_SERVICE" => "concierge-bell",
                            "FITNESS_CENTER" => "dumbbell",
                            "BUSINESS_CENTER" => "briefcase",
                            "INTERNET" => "globe",
                            "COFFEE_SHOP" => "coffee",
                            "AIR_CONDITIONING" => "fan"
                          }
                          
                          displayed_amenities = hotel[:amenities][0..5]
                        %>
                        <% displayed_amenities.each do |amenity| %>
                          <span class="inline-block mr-3 mb-1">
                            <i class="fas fa-<%= amenity_icons[amenity] || 'check' %> text-blue-500 mr-1"></i>
                            <%= amenity.split("_").map(&:capitalize).join(" ") %>
                          </span>
                        <% end %>
                        
                        <% if hotel[:amenities].length > 6 %>
                          <span class="text-blue-500 text-xs">+<%= hotel[:amenities].length - 6 %> more</span>
                        <% end %>
                      <% else %>
                        <span class="text-gray-500">Amenities information not available</span>
                      <% end %>
                    </p>
                  </div>
                </div>
              </div>
              
              <!-- Offers Section -->
              <div class="border-t border-gray-200 p-4">
                <h4 class="font-bold text-gray-700 mb-3">Available Offers</h4>
                
                <% if hotel[:offers].present? && hotel[:offers].any? %>
                  <% 
                    # Sort offers by price
                    sorted_offers = hotel[:offers].sort_by { |o| o.dig(:price, :total).to_f }
                    # Display only up to 3 offers
                    displayed_offers = sorted_offers[0..2]
                  %>
                  
                  <div class="space-y-3">
                    <% displayed_offers.each_with_index do |offer, index| %>
                      <div class="<%= index > 0 ? 'pt-3 border-t border-gray-200' : '' %>">
                        <div class="flex justify-between items-center">
                          <div>
                            <p class="font-medium">
                              <%= offer.dig(:room_type).present? ? offer[:room_type].capitalize : "Standard Room" %>
                            </p>
                            <p class="text-xs text-gray-500">
                              <%= offer[:board_type].present? ? offer[:board_type].capitalize : "Room only" %> 
                              | For <%= offer.dig(:guests, :adults) || params[:adults] || 2 %> guest<%= (offer.dig(:guests, :adults) || params[:adults].to_i || 2) > 1 ? 's' : '' %>
                            </p>
                          </div>
                          
                          <div class="text-right">
                            <p class="text-lg font-bold text-blue-600">
                              <%= offer.dig(:price, :total) || "N/A" %> <%= offer.dig(:price, :currency) || params[:currency] || "USD" %>
                            </p>
                            <p class="text-xs text-gray-500">per night</p>
                          </div>
                        </div>
                      </div>
                    <% end %>
                    
                    <% if sorted_offers.length > 3 %>
                      <p class="text-center text-sm text-blue-500">
                        +<%= sorted_offers.length - 3 %> more offer<%= sorted_offers.length - 3 > 1 ? 's' : '' %> available
                      </p>
                    <% end %>
                  </div>
                <% else %>
                  <p class="text-gray-500">No offers available at this time.</p>
                <% end %>
              </div>
              
              <!-- Card Footer -->
              <div class="border-t border-gray-200 flex">
                <a href="#" class="flex-1 p-3 text-center text-gray-700 hover:bg-gray-100 transition duration-150">
                  <i class="fas fa-info-circle mr-1"></i> Details
                </a>
                
                <%= link_to hotel_details_path(hotel_id: hotel[:id]), class: "flex-1 p-3 text-center text-blue-600 font-bold bg-blue-50 hover:bg-blue-100 transition duration-150" do %>
                  <i class="fas fa-search-dollar mr-1"></i> View Offers
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% elsif @error.present? %>
      <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 relative rounded-md">
        <button class="absolute top-0 right-0 mt-2 mr-2 text-red-700">&times;</button>
        <div class="flex items-center">
          <i class="fas fa-exclamation-circle mr-3 text-red-500 text-xl"></i>
          <div>
            <p class="font-bold">Error</p>
            <p><%= @error %></p>
          </div>
        </div>
      </div>
    <% else %>
      <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-6 rounded-md">
        <div class="flex justify-center items-center">
          <i class="fas fa-exclamation-triangle text-2xl text-yellow-600 mr-3"></i>
          <span>No hotels found matching your criteria. Try adjusting your search parameters.</span>
        </div>
      </div>
    <% end %>
    
    <div class="mt-8 text-center">
      <%= link_to hotel_search_path, class: "text-blue-600 hover:text-blue-800" do %>
        <i class="fas fa-search mr-1"></i> New Hotel Search
      <% end %>
      <span class="mx-2 text-gray-300">|</span>
      <%= link_to root_path, class: "text-blue-600 hover:text-blue-800" do %>
        <i class="fas fa-home mr-1"></i> Home
      <% end %>
    </div>
  </div>
</section>